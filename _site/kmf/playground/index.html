<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<title>Kevoree Modeling Framework :: PlayGround</title>
	<meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="keywords" content="modeling, MDE, MDA, framework, java, kotlin, scala, javascript">
	<meta name="author" content="Fouquet Francois">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/icon" href="../favicon.ico">
	<!-- CSS -->
	<link rel="stylesheet" href="../css/custom.min.css">
	<link rel="stylesheet" href="../css/tuktuk.min.css">
	<link rel="stylesheet" href="../css/tuktuk.theme.min.css">
	<link rel="stylesheet" href="../css/tuktuk.icons.css">
	<script src="../highlight/zepto.min.js"></script>
    <style type="text/css" media="screen">
      body {
          overflow: hidden;
      }
      #editor { 
          margin: 0;
          position: absolute;
          top: 10%;
          bottom: 25%;
          left: 0px;
          right: 15%;  
      }
      #output { 
          margin: 0;
          position: absolute;
          top: 80%;
          bottom: 0px;
          left: 0px;
          right: 15%;  
      }
	  #output_banner {
          margin: 0;
          position: absolute;
          top: 75%;
          bottom: 0px;
          left: 0px;
          right: 15%;  
	  }
	  #top {
		  height:10%;
          margin: 0;
          position: absolute;
          top: 0px;
          bottom: 0px;
          left: 0px;
          right: 15%;  
	  }
	  #drawPanel {
		  padding-top:20px;
		  height:100%;
          margin: 0;
          position: absolute;
          top: 0px;
          bottom: 0px;
          left: 85%;
          right: 0px;  
		  overflow : scroll;
	  }
	  
	  
	  /* Framework start from here */
	  ul.tree,
	  ul.tree ul {
	    list-style:none;
	    margin:0;
	    padding:0;
	  }

	  ul.tree ul {
	    margin-left:10px; /* indentation */
	    position:relative;
	  }

	  ul.tree ul:before {
	    content:"";
	    display:block;
	    width:0;
	    position:absolute;
	    top:0;
	    bottom:0;
	    left:0;
	    border-left:1px solid;
	  }

	  ul.tree li {
	    margin:0;
	    padding:0 12px; /* indentation + 2 */
	    font-size:14px;
	    line-height:20px; /* default list item `line-height` */
	    color:#FFF;
	    font-weight:bold;
	    position:relative;
	  }

	  ul.tree ul li:before {
	    content:"";
	    display:block;
	    width:10px; /* same with indentation */
	    height:0;
	    border-top:1px solid;
	    position:absolute;
	    top:10px;
	    left:0;
	  }

	  ul.tree ul li:last-child:before {
	    background:#4b5f6d; /* same with body background */
	    height:auto;
	    top:10px; /* (line-height/2) */
	    bottom:0;
	  }

    </style>
		
</head>
 
<body>
	
	<div id="drawPanel" class="bck color">
		<div id="metaReminder" style="margin-left:10px;margin-bottom:20px;">
			<i>Meta model</i><br />
			<img src="../img/cloud-reminder.png" />
		</div>
		
	</div>
	
	
	<div id="top" class="bck color padding-top padding-left">
		<div class="raw">
			<div class="column_4">
				<h4 class="color theme text bold"> <span class="icon beaker"></span> KMF Playground</h4>
			</div>			
			<form id="form" name="form" class="margin-top">
			<div class="column_2">
				<a class="button icon play-circle" onclick="executePlayGround();"> Execute</a>
			</div>
			<div class="column_4">
			    <fieldset style="width:300px" id="snippetchange">
			                        <label>Sample:<small>code snippet</small></label>
			                        <span class="select">
			                            <select id="snippetchangeSelect">
			                                <option value="snippets/snip1.js" selected>Simple usage</option>
			                                <option value="snippets/snip1bis.js">Aspects oriented</option>
			                                <option value="snippets/snip2.js">Save / Load / Clone</option>
			                                <option value="snippets/snip3.js">Merge / Diff</option>
											<option value="snippets/snip4.js">Events / Sync</option>
			                            </select>
			                        </span>
			                    </fieldset>
			</div>
		    </form>
		</div>		
	</div>
	
	<pre id="editor">
	</pre>

	<div id="output_banner">
		<div class="bck color padding-left" style="padding-bottom:100%;">
			<h3 class="color theme text bold"> Result goes here : <span class="icon down-sign" style="font-size: 22pt;"></span></h3>
		</div>
	</div>
	<pre id="output">
	</pre>
	
	<script src="lib/kotlin-lib-ecma3.js"></script>
	<script src="lib/kotlin-lib.js"></script>
	<script src="lib/kotlin-maps.js"></script>
	<script type="text/javascript" src="lib/org.kevoree.modeling.sample.cloud.js.js"></script>
	<script src="src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
	<script>
	
	function draw(cloud,txt){
		if(cloud.metaClassName != undefined && cloud.metaClassName() == "org.cloud.Cloud"){
			
			if(txt != undefined){
				var headerTxt = $('<i style="margin-left:10px;"></i>');
				headerTxt.text(txt);
				$('#drawPanel').append(headerTxt);
			}
			
			var CloudUL = $('<ul class="tree"></ul>');
			var CloudHeader = $('<li></li>');
			CloudHeader.text("Cloud");
			CloudUL.append(CloudHeader);
			var CloudNodesUL = $('<ul></ul>');
			CloudHeader.append(CloudNodesUL);
		    cloud.containedElementsList().array.forEach(function(node) {
				var NodeLI = $('<li></li>');
				CloudNodesUL.append(NodeLI);
				NodeLI.text("Node:"+node.getId());
				var SoftwareUL = $('<ul></ul>');
				NodeLI.append(SoftwareUL);
			    node.containedElementsList().array.forEach(function(soft) {
					var SoftLI = $('<li></li>');
					SoftLI.text("Soft:"+soft.getName());
					SoftwareUL.append(SoftLI);
			    });
		    });
			$('#drawPanel').append(CloudUL);
		}
	}
	

		//Global Cloud Model Variables
		var kevmod = Kotlin.modules['org.kevoree.modeling.sample.cloud.js'];
		var saver = new kevmod.org.cloud.serializer.JSONModelSerializer();
		var loader = new kevmod.org.cloud.loader.JSONModelLoader();
		var cloner = new kevmod.org.cloud.cloner.DefaultModelCloner();
		var compare = new kevmod.org.cloud.compare.DefaultModelCompare();
		var event2trace = new kevmod.org.kevoree.modeling.api.trace.Event2Trace(compare);
		//var ModelTraceApplicator = kevmod.org.cloud.trace.ModelTraceApplicator;
		var factory = new kevmod.org.cloud.impl.DefaultCloudFactory();
		var ActionType = kevmod.org.kevoree.modeling.api.util.ActionType;
		
	    var editor = ace.edit("editor");
	    editor.setTheme("ace/theme/twilight");
	    editor.getSession().setMode("ace/mode/javascript");
		
		
	    var output = ace.edit("output");
	    output.setTheme("ace/theme/twilight");
	   // editor.getSession().setMode("ace/mode/javascript");
		function executePlayGround(){
			var code = editor.getSession().getValue();
			output.getSession().setValue("");
			
			var previousHeader = $('#metaReminder');
			
			$('#drawPanel').empty();
			$('#drawPanel').append(previousHeader);

			try{eval(code);}
			catch(err){
				console.error(err);
				oldConsole.error(err);
			}
		}
		var oldConsole = console;
		var proxyConsole = {
			log : function(data){
				var txt = data;
				if(data.metaClassName != undefined){
					txt = "KMF Element : "+data.metaClassName();
				}
				output.getSession().setValue(output.getSession().getValue()+txt+"\n");
				output.gotoPageDown();
			},
			error : function(data){
				output.getSession().setValue(output.getSession().getValue()+"ERROR : "+data+"\n");
				output.gotoPageDown();
			}
		};
		console = proxyConsole;
		
		$("#snippetchange").change(function () {
			var selectedValue = $('#snippetchangeSelect').val();
			$.ajax({
			  url: selectedValue,
			  dataType: 'text',
			  success: function(data) {
			    editor.getSession().setValue(data);
			  }
			});
		 });
		
		 //init
		var selectedValue = $('#snippetchangeSelect').val();
		$.ajax({
		  url: selectedValue,
		  dataType: 'text',
		  success: function(data) {
		    editor.getSession().setValue(data);
		  }
		});	
	</script>
	
</body>
</html>
