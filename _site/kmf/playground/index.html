<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<title>Kevoree Modeling Framework :: PlayGround</title>
	<meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="keywords" content="modeling, MDE, MDA, framework, java, kotlin, scala, javascript">
	<meta name="author" content="Fouquet Francois">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/icon" href="../favicon.ico">
	<!-- CSS -->
	<link rel="stylesheet" href="../css/custom.min.css">
	<link rel="stylesheet" href="../css/tuktuk.min.css">
	<link rel="stylesheet" href="../css/tuktuk.theme.min.css">
	<link rel="stylesheet" href="../css/tuktuk.icons.css">
	<script src="../highlight/zepto.min.js"></script>
    <style type="text/css" media="screen">
      body {
          overflow: hidden;
      }  
	  /* Framework start from here */
	  ul.tree,
	  ul.tree ul {
	    list-style:none;
	    margin:0;
	    padding:0;
	  }

	  ul.tree ul {
	    margin-left:10px; /* indentation */
	    position:relative;
	  }

	  ul.tree ul:before {
	    content:"";
	    display:block;
	    width:0;
	    position:absolute;
	    top:0;
	    bottom:0;
	    left:0;
	    border-left:1px solid;
	  }

	  ul.tree li {
	    margin:0;
	    padding:0 12px; /* indentation + 2 */
	    font-size:14px;
	    line-height:20px; /* default list item `line-height` */
	    color:#FFF;
	    font-weight:bold;
	    position:relative;
	  }

	  ul.tree ul li:before {
	    content:"";
	    display:block;
	    width:10px; /* same with indentation */
	    height:0;
	    border-top:1px solid;
	    position:absolute;
	    top:10px;
	    left:0;
	  }

	  ul.tree ul li:last-child:before {
	    background:#24211E; /* same with body background */
	    height:auto;
	    top:10px; /* (line-height/2) */
	    bottom:0;
	  }
    </style>
	
    <link rel="stylesheet" href="lib/codemirror/codemirror.css">
    <script src="lib/codemirror/codemirror.js"></script>
    <script src="lib/codemirror/addon/edit/matchbrackets.js"></script>
    <script src="lib/codemirror/addon/edit/continuecomment.js"></script>
    <script src="lib/codemirror/addon/comment/comment.js"></script>
    <script src="lib/codemirror/addon/hint/show-hint.js"></script>
    <link rel="stylesheet" href="lib/codemirror/addon/hint/show-hint.css">

    <script src="lib/codemirror/mode/javascript/javascript.js"></script>
    <style type="text/css">.CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}</style>
    <script src="lib/acorn/acorn.js"></script>
    <script src="lib/acorn/acorn_loose.js"></script>
    <script src="lib/acorn/util/walk.js"></script>
    <script src="lib/tern/lib/signal.js"></script>
    <script src="lib/tern/lib/tern.js"></script>
    <script src="lib/tern/lib/def.js"></script>
    <script src="lib/tern/lib/comment.js"></script>
    <script src="lib/tern/lib/infer.js"></script>
    <script src="lib/tern/plugin/doc_comment.js"></script>
	<script src="lib/tern/plugin/node.js"></script>
	<script src="lib/tern/plugin/requirejs.js"></script>
	
    <script src="lib/codemirror/addon/tern/tern.js"></script>
    <link rel="stylesheet" href="lib/codemirror/addon/tern/tern.css">
	
	<style>
	html {
	    position: relative;
	    min-height: 100%;
	}
	body {
	    margin: 4% 0 25%; /* bottom = footer height */
	}
	footer {
	    width: 85%;		
		position:fixed;
		bottom:0px;
		left:0px;
		color:#CCC;
		background:#333;
		padding:8px;		
	}
	.right {
	    position: absolute;
	    left: 85%;
		right:15%;
	    top: 0;
	    height: 100%;
	    width: 15%;
	}
	.codeBody{
	    height: 73%;
	    width: 85%;	
	}
	header {
		position:fixed;
			top:0px;
			left:0px;
			width:85%;
	}
	
	.CodeMirror {border: 0px solid black; font-size:13px}
	
	</style>
		
		
</head>
 
<body>
	
	<header class="bck dark">
		<div class="raw">
			<form id="form" name="form">
			<div class="column_4">
				<h4 class="color theme text bold"> <span class="icon beaker"></span> KMF Playground</h4>
			</div>			
			<div class="column_2">
				<a class="button icon play-circle" onclick="executePlayGround();"> Execute</a>
			</div>
			<div class="column_4">
			    <fieldset style="width:300px" id="snippetchange">
			                        <label>Sample:<small>code snippet</small></label>
			                        <span class="select">
			                            <select id="snippetchangeSelect">
			                                <option value="snippets/snip1.js" selected>Simple usage</option>
			                                <option value="snippets/snip1bis.js">Aspects oriented</option>
			                                <option value="snippets/snip2.js">Save / Load / Clone</option>
			                                <option value="snippets/snip3.js">Merge / Diff</option>
											<option value="snippets/snip4.js">Events / Sync</option>
			                            </select>
			                        </span>
			                    </fieldset>
			</div>
		    </form>
		</div>
	 </header>
	
	<div class="right bck center dark" style="padding-left:10px;color:white;">
			<div id="metaReminder">
				<i>Meta model</i><br />
				<img src="../img/cloud-reminder.png" />
			</div>
			<div id="drawPanel">
				
			</div>
	</div>
	
	<div class="codeBody">
		<textarea id="code" name="code">
		</textarea>	
	</div>


	<footer class="bck dark" style="position:absolute;bottom:0px;height:22%;width:85%;">
		<h3 class="color theme text bold"> Result goes here : <span class="icon down-sign" style="font-size: 22pt;"></span></h3>
		<textarea id="output" name="output"></textarea>
	</footer>
		
	<script type="text/javascript" src="lib/org.kevoree.modeling.sample.cloud.js.min.js"></script>
	<script>	
	function draw(cloud,txt){
		if(cloud.metaClassName != undefined && cloud.metaClassName() == "org.cloud.Cloud"){
			
			if(txt != undefined){
				var headerTxt = $('<i style="margin-left:10px;"></i>');
				headerTxt.text(txt);
				$('#drawPanel').append(headerTxt);
			}
			
			var CloudUL = $('<ul class="tree"></ul>');
			var CloudHeader = $('<li></li>');
			CloudHeader.text("Cloud");
			CloudUL.append(CloudHeader);
			var CloudNodesUL = $('<ul></ul>');
			CloudHeader.append(CloudNodesUL);
		    cloud.containedElementsList().array.forEach(function(node) {
				var NodeLI = $('<li></li>');
				CloudNodesUL.append(NodeLI);
				NodeLI.text("Node:"+node.getId());
				var SoftwareUL = $('<ul></ul>');
				NodeLI.append(SoftwareUL);
			    node.containedElementsList().array.forEach(function(soft) {
					var SoftLI = $('<li></li>');
					SoftLI.text("Soft:"+soft.getName());
					SoftwareUL.append(SoftLI);
			    });
		    });
			$('#drawPanel').append(CloudUL);
		}
	}
	

		//Global Cloud Model Variables
		var kevmod = Kotlin.modules['org.kevoree.modeling.sample.cloud.js'];
		var saver = new kevmod.org.cloud.serializer.JSONModelSerializer();
		var loader = new kevmod.org.cloud.loader.JSONModelLoader();
		var cloner = new kevmod.org.cloud.cloner.DefaultModelCloner();
		var compare = new kevmod.org.cloud.compare.DefaultModelCompare();
		var event2trace = new kevmod.org.kevoree.modeling.api.trace.Event2Trace(compare);
		//var ModelTraceApplicator = kevmod.org.cloud.trace.ModelTraceApplicator;
		var factory = new kevmod.org.cloud.impl.DefaultCloudFactory();
		var ActionType = kevmod.org.kevoree.modeling.api.util.ActionType;
		
        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
          lineNumbers: true,
          matchBrackets: true,
          continueComments: "Enter",
          extraKeys: {"Ctrl-Q": "toggleComment"}
        });
		
		function getURL(url, c) {
		    var xhr = new XMLHttpRequest();
		    xhr.open("get", url, true);
		    xhr.send();
		    xhr.onreadystatechange = function() {
		      if (xhr.readyState != 4) return;
		      if (xhr.status < 400) return c(null, xhr.responseText);
		      var e = new Error(xhr.responseText || "No response");
		      e.status = xhr.status;
		      c(e);
		    };
		  }

		  var server;
		  getURL("lib/tern/defs/ecma5.json", function(err, code) {
		    if (err) throw new Error("Request for ecma5.json: " + err);
		    server = new CodeMirror.TernServer({
				defs: [JSON.parse(code)],
				plugins: {requirejs: {},nodejs: {},node: {}, doc_comment: true},
			    workerDeps: [
				"../../../acorn/acorn.js", 
				"../../../acorn/acorn_loose.js",
			    "../../../acorn/util/walk.js", 
				"../../../tern/lib/signal.js", 
				"../../../tern/lib/tern.js",
			    "../../../tern/lib/def.js",
				"../../../tern/lib/infer.js", 
				"../../../tern/lib/comment.js",
			    "../../../tern/plugin/requirejs.js", 
				"../../../tern/plugin/doc_comment.js"],
			    workerScript: "lib/codemirror/addon/tern/worker.js",
			    useWorker: true
			});
		    editor.setOption("extraKeys", {
		      "Ctrl-Space": function(cm) { server.complete(cm); },
		      "Ctrl-I": function(cm) { server.showType(cm); },
		      "Alt-.": function(cm) { server.jumpToDef(cm); },
		      "Alt-,": function(cm) { server.jumpBack(cm); },
		      "Ctrl-Q": function(cm) { server.rename(cm); },
		    })
		    editor.on("cursorActivity", function(cm) { server.updateArgHints(cm); });
		  });
		
          var output = CodeMirror.fromTextArea(document.getElementById("output"), {
            lineNumbers: false
          });
		  		
		function executePlayGround(){
			var code = editor.getValue();
			output.setValue("");
			
			var previousHeader = $('#metaReminder');
			
			$('#drawPanel').empty();
			$('#drawPanel').append(previousHeader);

			try{eval(code);}
			catch(err){
				console.error(err);
				oldConsole.error(err);
			}
		}
		var oldConsole = console;
		var proxyConsole = {
			log : function(data){
				var txt = data;
				if(data.metaClassName != undefined){
					txt = "KMF Element : "+data.metaClassName();
				}
				output.setValue(output.getValue()+txt+"\n");
				//output.gotoPageDown();
			},
			error : function(data){
				output.setValue(output.getValue()+"ERROR : "+data+"\n");
				//output.gotoPageDown();
			}
		};
		console = proxyConsole;
		
		$("#snippetchange").change(function () {
			var selectedValue = $('#snippetchangeSelect').val();
			$.ajax({
			  url: selectedValue,
			  dataType: 'text',
			  success: function(data) {
	  		    editor.setValue(data);
			  }
			});
		 });
		
		 //init
		var selectedValue = $('#snippetchangeSelect').val();
		$.ajax({
		  url: selectedValue,
		  dataType: 'text',
		  success: function(data) {			  
		    editor.setValue(data);
		  }
		});	
	</script>
	
</body>
</html>
